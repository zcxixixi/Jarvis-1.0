# 🔊 Jarvis 音频问题排查与优化指南

本文档总结了 Jarvis 在树莓派上常见音频问题的成因与解决方案，帮助你理解如何避免“唤醒后不听话”和“音乐自动停”等现象。

## 1. 唤醒后听不到说话 (No Response after Wake)

### 现象
喊了 "Hey Jarvis"，听到了 "叮咚" 声，但之后无论说什么，Jarvis 都没有反应，或者直接超时。

### 原因 A: 唤醒音干扰 (The "Ding" Interference)
*   **原理**: 麦克风离扬声器太近，"叮咚" 声被麦克风录入并发给云端。云端 ASR (语音识别) 听到 "叮咚" 以为你的一句话说完了，或者将其视为噪音处理，导致后续的真实语音被 VAD (语音活动检测) 截断或忽略。
*   **代码解法 (已部署)**: 在 `hybrid_jarvis.py` 中，播放唤醒音后强制忽略 **0.3秒** 的音频输入。这给了 "叮咚" 声消散的时间。
*   **物理建议**: 
    *   不要让麦克风正对着扬声器。
    *   使用带回声消除 (AEC) 的会议麦克风效果更佳。

### 原因 B: 误唤醒循环 (False Wake Loop)
*   **原理**: 唤醒灵敏度 (Threshold) 设得太低 (如 0.3)。Jarvis 听到自己的 "叮咚" 声的回声，甚至环境噪音，误以为是用户在叫它。这会导致它不断“自我唤醒”并重置会话，根本没机会进入“听指令”的状态。
*   **代码解法 (已部署)**: 将 `wake_word.py` 中的默认阈值提高到 **0.5**。

## 2. 音乐播放自动停止 (Music Stops Unexpectedly)

### 现象
刚开始播放音乐，几秒钟后音乐突然停止，Jarvis 进入待机状态，尽管没有人说话。

### 原因: 回声误触 (Echo Trigger)
*   **原理**: 音乐声音被麦克风听到，OpenWakeWord 误判音乐中的人声或旋律为 "Hey Jarvis" 唤醒词。一旦检测到唤醒，为了听清你的指令，Jarvis 会自动停止音乐。
*   **代码解法 (已部署)**: 实现了 **动态阈值 (Dynamic Threshold)**。
    *   **平时**: 阈值 0.5 (容易唤醒)。
    *   **放歌时**: 阈值自动提高到 **0.85**。
    *   这意味着在放歌时，你需要比平时**更大声、更清晰**地喊 "Hey Jarvis" 才能打断它，从而防止音乐自己把自己停掉。

## 3. 最佳实践建议

1. **说话节奏**: 
   *   喊 "Hey Jarvis" -> (听到叮咚) -> **稍微停顿 0.5秒** -> 说命令。
   *   虽然代码修好了，但稍微停顿一下总是最稳的。

2. **音量平衡**:
   *   Jarvis 的回复音量和音乐音量最好分开。目前代码已将音乐限制在 50% 音量，回复保持 90%，这样既不吵也能听清。

3. **环境**:
   *   如果周围非常吵（电视、谈话），OpenWakeWord 可能会频繁误触。这种情况下，可以考虑在 `.env` 文件中进一步调高 `WAKE_THRESHOLD` (例如到 0.6 或 0.7)。
