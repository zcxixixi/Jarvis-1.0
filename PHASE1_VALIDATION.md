# Hybrid Jarvis é›†æˆéªŒè¯æ¸…å•

## ğŸ¯ éªŒè¯ç›®æ ‡

ç¡®è®¤ Phase 1 TTS è¿æ¥æ± é›†æˆåï¼ŒJarvis å®é™…è¿è¡Œï¼š
1. âœ… èƒ½æ­£å¸¸å¯åŠ¨
2. âœ… TTS è¿æ¥å¤ç”¨ç”Ÿæ•ˆ
3. âœ… å»¶è¿Ÿæœ‰æ”¹å–„
4. âœ… æ— åŠŸèƒ½å›å½’

---

## ğŸš€ å¯åŠ¨å‘½ä»¤

```bash
cd /Users/kaijimima1234/Desktop/jarvis
./venv/bin/python3 jarvis_assistant/core/hybrid_jarvis.py
```

---

## ğŸ“‹ éªŒè¯æ­¥éª¤

### Step 1: å¯åŠ¨æ£€æŸ¥ âœ…

**è§‚å¯Ÿå¯åŠ¨æ—¥å¿—ä¸­åº”è¯¥å‡ºç°:**

```
ğŸ”§ HybridJarvis: Initializing...
ğŸ”Œ HybridJarvis: TTS Singleton initialized (connection pooling enabled)  # â† æ–°å¢
ğŸ§  HybridJarvis: Cognitive Brain Connected
â° HybridJarvis: Proactive Scheduler Linked
```

**âœ… æˆåŠŸæ ‡å¿—:** çœ‹åˆ° `TTS Singleton initialized`

**âŒ å¤±è´¥æ ‡å¿—:** 
- å¯¼å…¥é”™è¯¯
- AttributeError (è¯´æ˜ä»£ç ä¿®æ”¹æœ‰é—®é¢˜)

---

### Step 2: é¦–æ¬¡å¯¹è¯æµ‹è¯• ğŸ—£ï¸

**æµ‹è¯•æ­¥éª¤:**
1. è¯´ "å˜¿ Jarvis" (å”¤é†’)
2. è¯´ "ä½ å¥½" (ç®€å•é—®å€™)

**è§‚å¯Ÿæ—¥å¿—:**

```
ğŸ”¥ [TTS V1] Establishing persistent connection  # â† é¦–æ¬¡åº”è¯¥å‡ºç°
ğŸ”ˆ Stream TTS: ä½ å¥½å‘€ï¼...
```

**âœ… æˆåŠŸæ ‡å¿—:**
- å¬åˆ° Jarvis å›å¤
- æ—¥å¿—æ˜¾ç¤º TTS è¿æ¥å»ºç«‹
- å»¶è¿Ÿ < 2s

**âŒ å¤±è´¥æ ‡å¿—:**
- æ— å£°éŸ³
- é”™è¯¯æ—¥å¿— (AttributeError, connection failed)

---

### Step 3: è¿æ¥å¤ç”¨éªŒè¯ ğŸ”Œ

**æµ‹è¯•æ­¥éª¤:**
1. è¯´ "å˜¿ Jarvis"
2. è¯´ "ç°åœ¨å‡ ç‚¹" (ç¬¬ 2 æ¬¡å¯¹è¯)
3. ç­‰å¾…å›å¤
4. è¯´ "å˜¿ Jarvis"
5. è¯´ "å¤©æ°”æ€ä¹ˆæ ·" (ç¬¬ 3 æ¬¡å¯¹è¯)

**è§‚å¯Ÿæ—¥å¿— (å…³é”®):**

```
# ç¬¬ 1 æ¬¡å¯¹è¯
ğŸ”¥ [TTS V1] Establishing persistent connection  # â† åº”è¯¥å‡ºç°

# ç¬¬ 2 æ¬¡å¯¹è¯
ğŸ”ˆ Stream TTS: ç°åœ¨æ˜¯ ...  # â† åº”è¯¥ **æ²¡æœ‰** "Establishing" æ—¥å¿—

# ç¬¬ 3 æ¬¡å¯¹è¯
ğŸ”ˆ Stream TTS: æˆ‘ç°åœ¨æ²¡æ³•...  # â† åº”è¯¥ **æ²¡æœ‰** "Establishing" æ—¥å¿—
```

**âœ… æˆåŠŸæ ‡å¿—:**
- **åªæœ‰é¦–æ¬¡å‡ºç°** `Establishing persistent connection`
- åç»­å¯¹è¯æ²¡æœ‰é‡è¿æ—¥å¿—
- ç¬¬ 2/3 æ¬¡å¯¹è¯æ¯”ç¬¬ 1 æ¬¡å¿« ~100-200ms

**âŒ å¤±è´¥æ ‡å¿—:**
- æ¯æ¬¡å¯¹è¯éƒ½å‡ºç° `Establishing connection` (è¯´æ˜è¿æ¥æ± æœªç”Ÿæ•ˆ)
- å»¶è¿Ÿæ²¡æœ‰æ”¹å–„

---

### Step 4: å»¶è¿Ÿå¯¹æ¯” â±ï¸

**æ‰‹åŠ¨è®¡æ—¶ (å¯é€‰ä½†æ¨è):**

ä½¿ç”¨æ‰‹æœºç§’è¡¨ï¼Œæµ‹é‡ä»**è¯´å®Œè¯**åˆ°**å¬åˆ°å£°éŸ³**çš„æ—¶é—´ï¼š

| å¯¹è¯æ¬¡æ•° | æŸ¥è¯¢å†…å®¹ | å»¶è¿Ÿ (ç§’) | é¢„æœŸ |
|---------|---------|----------|------|
| 1 | "ä½ å¥½" | ? | < 2s (å†·å¯åŠ¨) |
| 2 | "ç°åœ¨å‡ ç‚¹" | ? | < 1.8s (çƒ­è¿æ¥) |
| 3 | "å¤©æ°”æ€ä¹ˆæ ·" | ? | < 1.8s (çƒ­è¿æ¥) |

**âœ… æˆåŠŸæ ‡å¿—:**
- ç¬¬ 2/3 æ¬¡æ¯”ç¬¬ 1 æ¬¡å¿« 10-20%
- æ€»å»¶è¿Ÿ < 2s

---

### Step 5: åŠŸèƒ½å›å½’æµ‹è¯• ğŸ› ï¸

**æµ‹è¯•å„ç§å·¥å…·è°ƒç”¨:**

```
"å˜¿ Jarvis, ç°åœ¨å‡ ç‚¹"        â†’ æ—¶é—´å·¥å…·
"å˜¿ Jarvis, æ’­æ”¾éŸ³ä¹"        â†’ éŸ³ä¹å·¥å…·
"å˜¿ Jarvis, å¤©æ°”æ€ä¹ˆæ ·"      â†’ å¤©æ°”å·¥å…·
"å˜¿ Jarvis, å¸®æˆ‘è®¡ç®— 2+2"    â†’ è®¡ç®—å·¥å…·
```

**âœ… æˆåŠŸæ ‡å¿—:**
- æ‰€æœ‰å·¥å…·æ­£å¸¸å“åº”
- éŸ³è´¨æ­£å¸¸ï¼Œæ— æ‚éŸ³/æˆªæ–­

**âŒ å¤±è´¥æ ‡å¿—:**
- æŸäº›åŠŸèƒ½å¤±æ•ˆ
- éŸ³é¢‘è´¨é‡ä¸‹é™

---

## ğŸ” å…³é”®æ—¥å¿—æ ‡è¯†

### âœ… è¿æ¥æ± æ­£å¸¸

```log
ğŸ”Œ HybridJarvis: TTS Singleton initialized (connection pooling enabled)
ğŸ”¥ [TTS V1] Establishing persistent connection  # åªåœ¨é¦–æ¬¡å‡ºç°
ğŸ”ˆ Stream TTS: ...  # åç»­ç›´æ¥åˆæˆ
```

### âŒ è¿æ¥æ± æœªç”Ÿæ•ˆ

```log
ğŸ”¥ [TTS V1] Establishing persistent connection  # æ¯æ¬¡éƒ½å‡ºç°
ğŸ”¥ [TTS V1] Establishing persistent connection  # é‡å¤è¿æ¥
```

---

## ğŸ› æ•…éšœæ’æŸ¥

### é—®é¢˜ 1: å¯¼å…¥é”™è¯¯

**ç—‡çŠ¶:**
```
ImportError: cannot import name 'get_doubao_tts'
```

**è§£å†³:**
```bash
# æ£€æŸ¥æ–‡ä»¶å­˜åœ¨
ls jarvis_assistant/io/tts/doubao.py
ls jarvis_assistant/io/tts/__init__.py

# é‡æ–°å¯¼å…¥
./venv/bin/python3 -c "from jarvis_assistant.io.tts import get_doubao_tts; print('OK')"
```

---

### é—®é¢˜ 2: AttributeError

**ç—‡çŠ¶:**
```
AttributeError: 'DoubaoTTS' object has no attribute '_ensure_connected'
```

**è§£å†³:**
æ£€æŸ¥ `io/tts/doubao.py` æ–‡ä»¶æ˜¯å¦å®Œæ•´

---

### é—®é¢˜ 3: æ¯æ¬¡éƒ½é‡è¿

**ç—‡çŠ¶:**
æ—¥å¿—ä¸­æ¯æ¬¡å¯¹è¯éƒ½æ˜¾ç¤º `Establishing connection`

**åŸå› :**
- è¿æ¥æ„å¤–å…³é—­
- å•ä¾‹æœªæ­£ç¡®å…±äº«

**æ£€æŸ¥:**
```python
# åœ¨ Python REPL éªŒè¯
from jarvis_assistant.io.tts import get_doubao_tts
tts1 = get_doubao_tts()
tts2 = get_doubao_tts()
print(tts1 is tts2)  # åº”è¯¥æ˜¯ True
```

---

### é—®é¢˜ 4: æ— å£°éŸ³è¾“å‡º

**ç—‡çŠ¶:**
æ—¥å¿—æ­£å¸¸ä½†å¬ä¸åˆ°å£°éŸ³

**æ£€æŸ¥:**
1. æ‰¬å£°å™¨éŸ³é‡
2. éŸ³é¢‘è®¾å¤‡é€‰æ‹©
3. PyAudio è¾“å‡ºè®¾å¤‡

```bash
# æµ‹è¯•éŸ³é¢‘è®¾å¤‡
./venv/bin/python3 test_audio_playback.py --quick
```

---

## ğŸ“Š æ€§èƒ½åŸºå‡†

### é¢„æœŸå»¶è¿Ÿ (ä»è¯´è¯å®Œæˆåˆ°å¬åˆ°å£°éŸ³)

| åœºæ™¯ | å†·å¯åŠ¨ (é¦–æ¬¡) | çƒ­è¿æ¥ (åç»­) |
|------|--------------|-------------|
| ç®€å•é—®å€™ | 1.5-2s | 1.2-1.5s |
| å·¥å…·è°ƒç”¨ | 2-3s | 1.8-2.5s |
| å¤æ‚é—®ç­” | 3-4s | 2.5-3.5s |

### æ”¹å–„é¢„æœŸ

- âœ… åç»­å¯¹è¯æ¯”é¦–æ¬¡å¿« **10-20%**
- âœ… æ— é‡è¿æ—¥å¿— (å¤ç”¨ç‡ > 80%)

---

## âœ… éªŒè¯é€šè¿‡æ ‡å‡†

æ‰€æœ‰ä»¥ä¸‹æ¡ä»¶æ»¡è¶³ï¼š

- [x] Jarvis æ­£å¸¸å¯åŠ¨ï¼Œæ— é”™è¯¯
- [x] TTS å•ä¾‹æ—¥å¿—å‡ºç°
- [x] é¦–æ¬¡å¯¹è¯æœ‰è¿æ¥å»ºç«‹æ—¥å¿—
- [x] åç»­å¯¹è¯**æ— é‡è¿**æ—¥å¿—
- [x] å»¶è¿Ÿæ”¹å–„ 10-20%
- [x] æ‰€æœ‰åŠŸèƒ½æ­£å¸¸ (å·¥å…·ã€éŸ³è´¨)

**å¦‚æœä»¥ä¸Šå…¨éƒ¨é€šè¿‡ â†’ Phase 1 é›†æˆæˆåŠŸï¼âœ…**

---

## ğŸš¦ å¿«é€ŸéªŒè¯å‘½ä»¤

```bash
# 1. å¯åŠ¨ Jarvis
./venv/bin/python3 jarvis_assistant/core/hybrid_jarvis.py 2>&1 | tee jarvis_test.log

# 2. è¿è¡Œæµ‹è¯•å¯¹è¯ (å¦ä¸€ä¸ªç»ˆç«¯)
# è¯´è¯æµ‹è¯•: "å˜¿ Jarvis" â†’ "ä½ å¥½" â†’ "ç°åœ¨å‡ ç‚¹" â†’ "å¤©æ°”æ€ä¹ˆæ ·"

# 3. æ£€æŸ¥æ—¥å¿—
grep "Establishing persistent connection" jarvis_test.log | wc -l
# é¢„æœŸ: 1 (åªåœ¨é¦–æ¬¡å‡ºç°)

# 4. æ£€æŸ¥å•ä¾‹åˆå§‹åŒ–
grep "TTS Singleton initialized" jarvis_test.log
# é¢„æœŸ: å‡ºç°ä¸€æ¬¡
```

---

## ğŸ“ éªŒè¯æŠ¥å‘Šæ¨¡æ¿

å®Œæˆæµ‹è¯•åå¡«å†™ï¼š

```
âœ…/âŒ å¯åŠ¨æˆåŠŸ
âœ…/âŒ TTS å•ä¾‹åˆå§‹åŒ–
âœ…/âŒ é¦–æ¬¡å¯¹è¯æ­£å¸¸
âœ…/âŒ è¿æ¥å¤ç”¨ç”Ÿæ•ˆ (æ— é‡è¿æ—¥å¿—)
âœ…/âŒ å»¶è¿Ÿæ”¹å–„ (__%æå‡)
âœ…/âŒ åŠŸèƒ½æ— å›å½’

æ€»ä½“è¯„ä¼°: PASS / FAIL
```

---

å‡†å¤‡å¥½äº†å—ï¼Ÿè¿è¡Œä»¥ä¸‹å‘½ä»¤å¼€å§‹éªŒè¯ï¼š

```bash
cd /Users/kaijimima1234/Desktop/jarvis
./venv/bin/python3 jarvis_assistant/core/hybrid_jarvis.py
```
